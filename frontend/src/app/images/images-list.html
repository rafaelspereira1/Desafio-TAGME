<div class="login-bg">
  <div class="login-container mat-app-background">
    <mat-card>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
        "
      >
        <mat-card-title>Minhas Imagens</mat-card-title>
        <button mat-raised-button color="primary" (click)="goToUpload()">
          <mat-icon>add</mat-icon>
          Enviar Imagem
        </button>
      </div>
      <div
        style="
          margin-bottom: 1rem;
          display: flex;
          gap: 1rem;
          align-items: center;
        "
      >
        <mat-form-field appearance="fill" class="filter-title-field">
          <mat-label>Filtrar por título</mat-label>
          <input
            matInput
            [(ngModel)]="filterTitle"
            (ngModelChange)="onFilterChange()"
            placeholder="Título"
          />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Ordenar por</mat-label>
          <mat-select [(ngModel)]="orderBy" (ngModelChange)="onFilterChange()">
            <mat-option value="title">Título</mat-option>
            <mat-option value="createdAt">Data</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Ordem</mat-label>
          <mat-select [(ngModel)]="order" (ngModelChange)="onFilterChange()">
            <mat-option value="asc">Ascendente</mat-option>
            <mat-option value="desc">Descendente</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <table mat-table [dataSource]="images" matSort>
        <ng-container matColumnDef="preview">
          <th mat-header-cell *matHeaderCellDef>Preview</th>
          <td mat-cell *matCellDef="let image">
            <img
              *ngIf="getImageUrl(image)"
              [src]="getImageUrl(image)"
              alt="preview"
              style="
                height: 60px;
                border-radius: 8px;
                object-fit: cover;
                background: #222;
              "
              (error)="onImageError($event, image)"
              (load)="onImageLoad($event, image)"
            />
            <div
              *ngIf="!getImageUrl(image)"
              style="font-size: 12px; color: #f44336"
            >
              Imagem não disponível
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Título</th>
          <td mat-cell *matCellDef="let image">{{ image.title }}</td>
        </ng-container>
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Data</th>
          <td mat-cell *matCellDef="let image">
            {{ image.createdAt | date : "short" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let image">
            <button
              mat-icon-button
              color="warn"
              (click)="deleteImage(image.id)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator
        [length]="total"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        (page)="onPageChange($event)"
      ></mat-paginator>
    </mat-card>
  </div>
</div>
